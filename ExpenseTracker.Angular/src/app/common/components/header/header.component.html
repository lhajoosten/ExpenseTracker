<mat-toolbar color="primary" class="app-header">
    <!-- Left Section: Menu, Page Title, Search -->
    <div class="header-left">
      <button mat-icon-button class="menu-button" (click)="toggleSidebar()">
        <mat-icon>{{ sidenavCollapsed ? "menu_open" : "menu" }}</mat-icon>
      </button>
      <h1 class="page-title">{{ pageTitle }}</h1>
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-icon matPrefix>search</mat-icon>
          <input matInput placeholder="Search..." />
        </mat-form-field>
      </div>
    </div>

    <div class="spacer"></div>

    <!-- Right Section: Quick Add, Notifications, Auth / User Profile -->
    <div class="header-right">
      <!-- Quick Add Expense Button -->
      <button
        mat-mini-fab
        color="accent"
        class="quick-add-button"
        matTooltip="Add New"
        *ngIf="isAuthenticated"
        [matMenuTriggerFor]="quickAddMenu"
      >
        <mat-icon>add</mat-icon>
      </button>
      <mat-menu #quickAddMenu="matMenu">
        <button mat-menu-item (click)="quickAddExpense()">
          <mat-icon>receipt</mat-icon>
          <span>Add Expense</span>
        </button>
        <button mat-menu-item (click)="quickAddIncome()">
          <mat-icon>trending_up</mat-icon>
          <span>Add Income</span>
        </button>
        <button mat-menu-item (click)="quickAddCategory()">
          <mat-icon>category</mat-icon>
          <span>Add Category</span>
        </button>
      </mat-menu>

      <!-- Notification Button -->
      <button
        mat-icon-button
        class="notification-button"
        *ngIf="isAuthenticated"
        [matMenuTriggerFor]="notificationsMenu"
      >
        <mat-icon
          [matBadge]="notificationCount"
          [matBadgeHidden]="notificationCount === 0"
          matBadgeColor="warn"
        >
          notifications
        </mat-icon>
      </button>
      <mat-menu #notificationsMenu="matMenu" class="notifications-menu">
        <div class="notifications-header">
          <h2>Notifications</h2>
          <button mat-button *ngIf="notificationCount > 0" (click)="clearAllNotifications()">
            Clear All
          </button>
        </div>
        <mat-divider></mat-divider>
        <div class="notifications-content">
          <div *ngIf="notificationCount === 0" class="no-notifications">
            <mat-icon>notifications_off</mat-icon>
            <span>No new notifications</span>
          </div>
          <button mat-menu-item *ngFor="let i of [1, 2, 3]" class="notification-item">
            <mat-icon color="accent">info</mat-icon>
            <span>Notification {{ i }}</span>
            <span class="notification-time">{{ i }}h ago</span>
          </button>
        </div>
      </mat-menu>

      <!-- Authentication Buttons (when not authenticated) -->
      <ng-container *ngIf="!isAuthenticated">
        <button mat-raised-button color="accent" routerLink="/auth/login" class="auth-button">
          <mat-icon>login</mat-icon>
          <span>Login</span>
        </button>
        <button mat-button routerLink="/auth/register" class="auth-button">
          <mat-icon>person_add</mat-icon>
          <span>Register</span>
        </button>
      </ng-container>

      <!-- User Profile Dropdown (when authenticated) -->
    <button
      mat-button
      *ngIf="isAuthenticated"
      [matMenuTriggerFor]="userMenu"
      class="user-profile-button"
    >
      <div class="user-profile-content" style="display: flex; align-items: center;">
        <div class="user-avatar-container" style="margin-right: 8px;">
        <img
          [src]="user?.photoUrl || 'assets/images/default-avatar.png'"
          alt="User Avatar"
          class="user-avatar"
        />
        <div class="status-indicator" [ngClass]="{ online: isOnline }"></div>
        </div>
        <div class="user-info" style="margin-right: 4px;">
        <span class="user-name">{{ user?.displayName || 'User' }}</span>
        <span class="user-email">{{ user?.email }}</span>
        </div>
        <mat-icon>arrow_drop_down</mat-icon>
      </div>
    </button>

      <mat-menu #userMenu="matMenu" class="user-menu">
        <div class="user-menu-header">
          <div class="user-avatar-container-large">
            <img
              [src]="user?.photoUrl || 'assets/images/default-avatar.png'"
              alt="User Avatar"
            />
          </div>
          <div class="user-details">
            <span class="user-name-large">{{ user?.displayName || 'User' }}</span>
            <span class="user-email-large">{{ user?.email }}</span>
          </div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item routerLink="/profile">
          <mat-icon>person</mat-icon>
          <span>Profile</span>
        </button>
        <button mat-menu-item routerLink="/settings">
          <mat-icon>settings</mat-icon>
          <span>Settings</span>
        </button>
        <button mat-menu-item routerLink="/notifications">
          <mat-icon>notifications</mat-icon>
          <span>Notifications</span>
          <span class="notification-badge" *ngIf="notificationCount > 0">
            {{ notificationCount }}
          </span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="toggleTheme()">
          <mat-icon>{{ isDarkTheme ? 'light_mode' : 'dark_mode' }}</mat-icon>
          <span>{{ isDarkTheme ? 'Light Theme' : 'Dark Theme' }}</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>exit_to_app</mat-icon>
          <span>Logout</span>
        </button>
      </mat-menu>
    </div>
  </mat-toolbar>
